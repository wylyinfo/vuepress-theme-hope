# 延时队列
https://juejin.im/post/6844903648397525006

## 使用场景

关注空闲连接。服务器中客户端连接，空闲一段时间后需要关闭

清理过期数据。如缓存对象超过空闲时间，需要从缓存中移除

任务超时处理。在网络协议滑动窗口请求应答式交互时，处理超时未响应的请求

订单超时取消。下单后三十分钟内没有付款自动取消订单

订餐通知。下单成功后60s后给用户发送短信通知

订单未支付退还库存。当订单一直处于未支付状态，如何及时关闭订单，并退还库存

定期检查退款状态。如何定期检查处于退款状态的订单是否已经退款成功

新创建店铺，N天内没有上传商品，系统如何知道该信息，并发送激活短信

定时任务调度：使用DelayQueue保存当天将会执行的任务和执行时间，一旦从DelayQueue中获取到任务就开始执行

## 实现方式

### 定期轮询（数据库等）

定期轮询数据库，设置状态。

优点：实现简单

缺点：数据量过大时会消耗太多的IO资源，效率太低

### DelayQueue

无界，延迟，阻塞队列

BlockingQueue+PriorityQueue（堆排序）+Delayed

DelayQueue中存放的对象需要实现compareTo()方法和getDelay()方法

getDelay方法返回该元素距离失效剩余时间，当<=0时元素失效，就可以从队列中取到

### Timer

ScheduledExecutorService

时间轮(kafka)

RabbitMQ

Quartz

Redis Zset

Koala

JCronTab

SchedulerX(阿里)

有赞延迟队列

